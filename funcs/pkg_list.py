import subprocess

#find all the install packages + versions and return
def pkg_list() -> dict:
    #designed to check the dpkg log. Would need modification for distros not using dpkg
    pkg_list = subprocess.run(["grep", " install ", "/var/log/dpkg.log"],capture_output=True,text=True)
    pkg_dict = {}
    if pkg_list.returncode == 0:
        lines = pkg_list.stdout.split("\n")
        for line in lines:
            sw_info = line.split()
            if sw_info != []:
                pkg = sw_info[3].split(":")
                pkg = pkg[0]
                if "+" in pkg:
                    pkg = pkg.split("+")
                    pkg = pkg[0]
                ver = sw_info[5]
                if "+" in ver:
                    ver = ver.split("+")
                    ver = ver[0]
                if ":" in ver:
                    ver = ver.split(":")
                    ver = ver[0]
                if "~" in ver:
                    ver = ver.split("~")
                    ver = ver[0]
                #build package dict
                pkg_dict[pkg] = ver   
            else:
                continue
    else:
        return pkg_list.stderr
    
    return pkg_dict