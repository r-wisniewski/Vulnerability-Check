import subprocess
import funcs.nvd_vuln_check as nvd_vuln_check
import funcs.pkg_list as pkg_list
import pandas as pd
import os

#Get back a dict of install packages + versions
pkg_dict = pkg_list.pkg_list()

#if the subprocess worked correctly then proceed with the vulnerability check
if isinstance(pkg_dict, dict):
    #receive a pandas dataframe back
    OS_vulns = nvd_vuln_check.nvd_check(pkg_dict)
#error occurred, print error
else:
    print(pkg_dict)

#Write result to CSV
csv_name = os.uname()[1] + ".csv"
OS_vulns.to_csv(csv_name, encoding='utf-8', index=False)